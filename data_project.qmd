---
title: "FAOSTAT 2.3"
subtitle: "A revitalisation of the API wrapper of the FAOSTAT API"
date: "`r Sys.Date()`"
date-format: long
search: false
format:
    pdf: 
      mainfont: Cambria
    html: 
      include-in-header: lib/html/favicon.html
      self-contained: true
filters:
  - abstract-section
reference-location: margin
cap-location: margin
bibliography: FAOSTAT.bib
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
```

# Abstract
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec sed sapien dolor. Nulla in consectetur urna. Morbi lacinia ornare massa vel viverra. Vestibulum vel venenatis dolor. Nulla facilisi. Duis suscipit nunc id viverra eleifend. Nullam imperdiet risus malesuada aliquam luctus. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.

### Other formats
[{{< fa file-code >}} HTML report](https://sebastian-c.github.io/uls-data-project/data_project.html) | [{{< fa file-pdf >}} PDF report](https://sebastian-c.github.io/uls-data-project/data_project.pdf) | [{{< fa expand >}} Presentation](https://sebastian-c.github.io/uls-data-project/data_project_presentation.html) | [{{< fa brands github >}} GitHub](https://github.com/sebastian-c/uls-data-project) 

## Project background

The motivation for this project came from a Data Mining project from UniLaSalle. It was suggested that we use FAO^[Food and Agriculture Organization of the United Nations] data from their statistical platform FAOstat^[Food and Agriculture Organization Corporate Statistical Database]. As R was the language of choice, the obvious port of call was the 
FAOSTAT package^[For the purposes of clarity, this document will use the style "FAOSTAT" for the R package and "FAOstat" for the statistical platform] [@Kao2022a], developed by employees at FAO.

However, the FAOSTAT package did not work. It could not download data from the API and could only download bulk data with the entirety of a dataset in one go. For the particular dataset we were interested in, we found that there was a discrepancy between the data in the bulk download and the data on the web platform.^[This discrepancy has been fixed as of 2023-03-10]

Eventually it became necessary to use the same API that the FAOstat website uses to pull data. This method worked and it became clear that it could be used to revitalise the FAOSTAT package and part of an effort to restore it to full functionality.

## FAOstat

FAOstat is FAO's web-based statistical platform for the free dissemination of food and agriculture statistics. This data is obtained from questionnaires that FAO distributes throughout the world every year [@FAO2019]. Some of its data also comes from imputations and models where data is not available, but official country data takes precedence.

```{r}
#| label: fig-faostat_mentions
#| fig-cap: "Academic papers referencing FAOSTAT over the last 25 years [@Strobel2018]"

fao_mentions <- read.csv("data/faostat_mentions.csv")

ggplot(fao_mentions, aes(x = year, y = results)) +
  geom_col() +
  theme_minimal() +
  labs(title = "Academic papers referencing FAOSTAT 1998-2023",
       x = "Year",
       y = ("Number of papers"))
```

The FAOstat service is a public-facing aspect of FAO, with an overall trend of increasing citations in academic papers year on year with a peak of 21 400 citations in 2021 (@fig-faostat_mentions).

![FAOstat interface for exploration of country data](img/faostat.png){#fig-faostat_interface}

This platform uses a REST API internally to communicate with its database as well as providing a set of zip files with the entirety of certain datasets in order to reduce the load on the database. This REST API allows the website to generate CSVs as well as to allow exploration of the data via interactive graphs (@fig-faostat_interface).

## FAOSTAT package

The FAOSTAT package is an API wrapper to pull data from FAOSTAT into a R session. It can also perform small necessary tasks such as country code conversion and coalescing data from different country groups.^[For example, China may be just the mainland or may include Taiwan (Chinese Taipei), Hong Kong and Macao]

### History

The FAOSTAT package was originally developed in 2013 as a tool to source data for the SYB^[Statistical Year Book] project. The yearbooks are yearly summaries of the worldwide state of agriculture for that year. At the time, they were manually typeset and compiled. The new SYB project was to use a combination of `LaTeX`, `knitr` and `R` to automatically pull data from FAOSTAT and other data sources such as the World Bank. This data would be then be transformed and processed to create graphs and tables before finally formatting and typesetting to create a finished product which could then be printed.^[The author has no insight into the current production of the SYB, but they are still being produced and can be found on the [FAO website](https://www.fao.org/documents/card/en/c/cc2211en)].  Given that this use case no longer exists, the primary use of this package is for researchers and other R users to read data from FAOstat in a clean way that makes it easier to move to analysis afterwards.

It is a reasonably popular package in the 86th percentile of all packages on CRAN on 2023-04-01 by downloads. In total, the package has been downloaded over 50 000 times with a peak 121 daily downloads on 2019-05-15. [@Li2023]

The package was maintained by Michael Kao, the author, from 2013 to 2014. In 2014, it was maintained by Filippo Gheri before passing to Paul Rougieux (the current maintainer) in 2020. 

While it was [originally hosted on Github](https://github.com/mkao006/FAOSTATpackage) under Michael Kao's personal account, It is [currently hosted on GitLab](https://gitlab.com/paulrougieux/faostatpackage/) under Paul Rougieux's personal account.

### Current state

The FAOSTAT package has only a shadow of its former functionality. While it has retained the ability to download and process zip files and country code processing functions,^[For a full description of the status of individual issues, please see the GitLab issue [#20 Remove functions linked to defunct uses of FAOSTAT](https://gitlab.com/paulrougieux/faostatpackage/-/issues/20)] its capacities are limited by the following issues:

#### Functionality locked to the Statistical Yearbook

A number of functions are simply designed to pull in data from other sources such as the World Bank and to process that data into a format easily consumed by the Statistical Yearbook. As the yearbook no longer uses the FAOSTAT package, these functions have no further purpose, serving only to clog up the package and its help files.

#### Functionality powered by local files

Many uses of FAOSTAT require data outside of the data that comes directly from FAOSTAT. The major use case is for code conversions. There are two main code types that require conversion:

- Country codes
  - *FAO* FAO's internal codes for countries^[For further details about FAO and how it handles country identification, see [FAO's NOCS database](https://www.fao.org/nocs/en)]
  - *M49* The UN standard country codes
  - ISO2 & ISO3
- Item codes
  - FAO
  - CPC

#### Change of FAOstat API

- Lots of SYB functions
- Maintained by someone outside of FAO (European Commission)

## Project goals

- Fix up core functions
- Transfer maintainership

## Methods

Please see issues in milestone: https://gitlab.com/paulrougieux/faostatpackage/-/issues/?sort=created_date&state=closed&milestone_title=2.3.0&first_page_size=20

- Refactor essential functions
  - getFAO -> read_fao
  - FAOsearch -> search_fao
  
- Add caching
- Add column metadata
- documentation, examples, tests

## Use case

- Check health of zip data
- Display availability of certain country data (shiny app)
  - Graph per country
  - Colour by flag

## Future work

- Release 3.0.0
  - Fully integrating with the new API
- Publishing a paper in [JOSS](https://joss.theoj.org/papers/published)
- Publish news in rweekly
- Publish 

## Funding declaration

This project has been funded by the Food and Agriculture Organization of the United Nations and the author is grateful for their help in reviving it.

## Bibliography

::: {#refs}
:::